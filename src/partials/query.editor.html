<query-editor-row query-ctrl="ctrl" can-collapse="false">
  <div class="gf-form-inline">
    <div class="gf-form max-width-20">
      <label class="gf-form-label query-keyword width-9">
        Datasources
        <label class="gf-form-label" bs-tooltip="ctrl.errors.druidDS" style="color: rgb(229, 189, 28)" ng-show="ctrl.errors.metric">
          <i class="fa fa-warning"></i>
        </label>
      </label>
      <input type="text" class="gf-form-input input-medium" ng-model="ctrl.target.druidDS" spellcheck='false' bs-typeahead="ctrl.listDataSources" placeholder="druidDS" data-min-length=0 ng-blur="ctrl.targetBlur()">
      </input>
    </div>
    <div class="gf-form">
      <label class="gf-form-label query-keyword width-4">
        Type
        <a bs-tooltip="ctrl.errors.queryTypes" style="color: rgb(229, 189, 28)" ng-show="ctrl.errors.queryTypes">
          <i class="fa fa-warning"></i>
        </a>
      </label>
      <div class="gf-form-select-wrapper max-width-15">
        <select ng-model="ctrl.target.queryType" class="gf-form-input" ng-options="type for type in ctrl.queryTypes" ng-change="ctrl.targetBlur()">
        </select>
      </div>
    </div>
    <gf-form-switch class="gf-form" label="Custom Granularity" label-class="query-keyword" checked="ctrl.target.shouldOverrideGranularity" on-change="ctrl.targetBlur()">
    </gf-form-switch>

    <div class="gf-form" ng-hide="!ctrl.target.shouldOverrideGranularity">
        <input type="text" class="gf-form-input input-medium" ng-model="ctrl.target.customGranularity" spellcheck='false' bs-typeahead="ctrl.customGranularity" placeholder="granularity" data-min-length=0 ng-blur="ctrl.targetBlur()">
        </input>
    </div>

    <div class="gf-form max-width-20" ng-hide="ctrl.target.shouldOverrideGranularity">
      <label class="gf-form-label query-keyword">
        Max Data Points
        <label class="gf-form-label" bs-tooltip="ctrl.errors.maxDataPoints" style="color: rgb(229, 189, 28)" ng-show="ctrl.errors.maxDataPoints">
          <i class="fa fa-warning"></i>
        </label>
      </label>
      <input type="text" class="gf-form-input" ng-model="ctrl.target.maxDataPoints" spellcheck='false' placeholder="default" ng-blur="ctrl.targetBlur()">
      </input>
    </div>
    <div class="gf-form gf-form--grow">
      <div class="gf-form-label gf-form-label--grow"></div>
    </div>
  </div>

  <div class="gf-form-inline" ng-switch on="ctrl.target.queryType">
    <div ng-switch-when="topN" class="gf-form max-width-20">
      <label class="gf-form-label query-keyword width-9">
        Dimension
      </label>
      <input type="text" class="gf-form-input" ng-model="ctrl.target.dimension" spellcheck='false' placeholder="dimension" bs-typeahead="ctrl.getDimensions" data-min-length=0 ng-blur="ctrl.targetBlur()" />
      <label class="gf-form-label" bs-tooltip="ctrl.target.errors.dimension" style="color: rgb(229, 189, 28)" ng-show="ctrl.target.errors.dimension">
        <i class="fa fa-warning"></i>
      </label>
    </div>
    <div ng-switch-when="topN" class="gf-form">

      <label class="gf-form-label query-keyword width-4">
        Metric
      </label>
      <input type="text" class="gf-form-input" ng-model="ctrl.target.druidMetric" spellcheck='false' placeholder="metric" ng-blur="ctrl.targetBlur()" />
      <label class="gf-form-label" bs-tooltip="ctrl.target.errors.druidMetric" style="color: rgb(229, 189, 28)" ng-show="ctrl.target.errors.druidMetric">
        <i class="fa fa-warning"></i>
      </label>
    </div>
    <div ng-switch-when="topN" class="gf-form">
      <label class="gf-form-label query-keyword width-4">
        Limit
      </label>
      <input type="number" required class="gf-form-input input-small" ng-model="ctrl.target.limit" spellcheck='false' ng-blur="ctrl.targetBlur()" />
      <label class="gf-form-label" bs-tooltip="ctrl.target.errors.limit" style="color: rgb(229, 189, 28)" ng-show="ctrl.target.errors.limit">
        <i class="fa fa-warning"></i>
      </label>
    </div>
    <div ng-switch-when="groupBy" class="gf-form max-width-20">
      <label class="gf-form-label query-keyword width-9">
        Group By
      </label>
      <input type="text" class="gf-form-input input-medium" ng-model="ctrl.target.groupBy" spellcheck='false' placeholder="dim1,dim2" bs-typeahead="ctrl.getDimensions" data-min-length=0 ng-blur="ctrl.targetBlur()" />
      <label class="gf-form-label" bs-tooltip="ctrl.target.errors.groupBy" style="color: rgb(229, 189, 28)" ng-show="ctrl.target.errors.groupBy">
        <i class="fa fa-warning"></i>
      </label>
    </div>
    <div ng-switch-when="groupBy" class="gf-form">

      <label class="gf-form-label query-keyword width-4">
        Limit
      </label>
      <input type="number" required class="gf-form-input input-small" ng-model="ctrl.target.limit" spellcheck='false' ng-blur="ctrl.targetBlur()" />
      <label class="gf-form-label" bs-tooltip="ctrl.target.errors.limit" style="color: rgb(229, 189, 28)" ng-show="ctrl.target.errors.limit">
        <i class="fa fa-warning"></i>
      </label>
    </div>
    <div ng-switch-when="groupBy" class="gf-form">
      <label class="gf-form-label query-keyword width-5">
        Order
      </label>
      <input type="text" required class="gf-form-input input-medium" ng-model="ctrl.target.orderBy" spellcheck='false' placeholder="col1,col2" bs-typeahead="ctrl.getDimensions" ng-blur="ctrl.targetBlur()" />
      <label class="gf-form-label" bs-tooltip="ctrl.target.errors.getDimensions" style="color: rgb(229, 189, 28)" ng-show="ctrl.target.errors.getDimensions">
        <i class="fa fa-warning"></i>
      </label>
    </div>
    <div ng-switch-when="select" class="gf-form">
      <label class="gf-form-label query-keyword width-9">
        Dimensions
        <info-popover mode="right-normal">
          (empty = *)
        </info-popover>
      </label>
    </div>
    <div class="gf-form" ng-switch-when="select" ng-repeat="dim in ctrl.target.selectDimensions track by $index">
      <label class="gf-form-label">&nbsp;{{dim}}
        <a ng-click="ctrl.removeSelectDimension($index)">
          <i class="fa fa-remove"></i>
        </a>
      </label>
    </div>
    <div class="gf-form" ng-switch-when="select" ng-hide="ctrl.addDimensionsMode">
      <label class="gf-form-label query-keyword">
        <a ng-click="ctrl.addSelectDimensions()"><i class="fa fa-plus"></i></a>
      </label>
    </div>
    <div class="gf-form" ng-switch-when="select" ng-show="ctrl.addDimensionsMode">
      <input type="text" class="gf-form-input input-medium" ng-model="ctrl.target.currentSelect.dimension" spellcheck='false' placeholder="dimension" data-min-length=0 data-items=100 bs-typeahead="ctrl.getDimensions" />
      <label class="gf-form-label" ng-show="ctrl.errors.selectDimensions">
        <a bs-tooltip="ctrl.errors.selectDimensions" style="color: rgb(229, 189, 28)">
          <i class="fa fa-warning"></i>
        </a>
      </label>
      <label class="gf-form-label">
        <a ng-click="ctrl.addSelectDimensions()" ng-hide="ctrl.errors.selectDimensions">add tag</a>
        <a ng-click="ctrl.clearCurrentSelectDimension()"><i class="fa fa-remove"></i></a>
      </label>
    </div>
    <div ng-switch-when="select" class="gf-form">
      <label class="gf-form-label query-keyword width-8">
        Metrics
        <info-popover mode="right-normal">
          (empty = *)
        </info-popover>
      </label>
    </div>
    <div class="gf-form" ng-switch-when="select" ng-repeat="metric in ctrl.target.selectMetrics track by $index">
      <label class="gf-form-label">&nbsp;{{metric}}
        <a ng-click="ctrl.removeSelectMetric($index)">
          <i class="fa fa-remove"></i>
        </a>
      </label>
    </div>
    <div class="gf-form" ng-switch-when="select" ng-hide="ctrl.addMetricsMode">
      <label class="gf-form-label query-keyword">
        <a ng-click="ctrl.addSelectMetrics()"><i class="fa fa-plus"></i></a>
      </label>
    </div>
    <div class="gf-form" ng-show="ctrl.addMetricsMode">
      <input type="text" class="gf-form-input input-medium" ng-model="ctrl.target.currentSelect.metric" spellcheck='false' placeholder="metric" data-min-length=0 data-items=100 bs-typeahead="ctrl.getMetrics" />
      <label class="gf-form-label" ng-show="ctrl.errors.selectMetrics">
        <a bs-tooltip="ctrl.errors.selectMetrics" style="color: rgb(229, 189, 28)">
          <i class="fa fa-warning"></i>
        </a>
      </label>
      <label class="gf-form-label">
        <a ng-click="ctrl.addSelectMetrics()" ng-hide="ctrl.errors.selectMetrics">add tag</a>
        <a ng-click="ctrl.clearCurrentSelectMetric()"><i class="fa fa-remove"></i></a>
      </label>
    </div>
    <div ng-switch-when="select" class="gf-form">
      <label class="gf-form-label query-keyword">
        threshold
      </label>
      <input type="number" required class="gf-form-input input-small" ng-model="ctrl.target.selectThreshold" placeholder="5" spellcheck='false' ng-blur="ctrl.targetBlur()" />
      <a bs-tooltip="ctrl.target.errors.selectThreshold" style="color: rgb(229, 189, 28)" ng-show="ctrl.target.errors.selectThreshold">
        <i class="fa fa-warning"></i>
      </a>
    </div>
    <div ng-if="ctrl.target.queryType != 'timeseries'" class="gf-form gf-form--grow">
      <div ng-if="ctrl.target.queryType != 'timeseries'" class="gf-form-label gf-form-label--grow"></div>
    </div>
  </div>

  <div class="gf-form-inline">
    <div class="gf-form max-width-20">
      <label class="gf-form-label query-keyword width-9">
        Query json
      </label>
    </div>
  </div>
  <div class="gf-form-inline">
    <div class="gf-form gf-form--grow">
      <code-editor content="ctrl.target.druidPartialQuery" on-change="ctrl.targetBlur()" data-mode="json">
      </code-editor>
    </div>
  </div>


</query-editor-row>
